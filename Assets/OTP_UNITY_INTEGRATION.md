# üîë –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OTP —Å–∏—Å—Ç–µ–º—ã –≤ Unity

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ OTP (One-Time Password) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞—Å—Å–∏—Ä–∞–º —Å–æ–∑–¥–∞–≤–∞—Ç—å 6-–∑–Ω–∞—á–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ AR —Ñ—É–Ω–∫—Ü–∏–π –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –≠—Ç–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–∞–º —á–µ—Ä–µ–∑ Freedom Pay.

## üéØ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. **Django Backend**
- ‚úÖ –ú–æ–¥–µ–ª—å `OTPCode` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–¥–æ–≤
- ‚úÖ –§–æ—Ä–º–∞ –¥–ª—è –∫–∞—Å—Å–∏—Ä–æ–≤ (—Å—É–º–º–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω—ã—Ö –∫–æ–¥–æ–≤
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Firebase
- ‚úÖ API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–æ–≤
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

### 2. **Unity Frontend**
- ‚úÖ `OTPManager.cs` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ OTP –∫–æ–¥–∞–º–∏
- ‚úÖ UI –¥–ª—è –≤–≤–æ–¥–∞ 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

## üöÄ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### **–î–ª—è –∫–∞—Å—Å–∏—Ä–∞:**
1. **–í—Ö–æ–¥ –≤ Django –∞–¥–º–∏–Ω–∫—É** –∫–∞–∫ –∫–∞—Å—Å–∏—Ä
2. **–°–æ–∑–¥–∞–Ω–∏–µ OTP –∫–æ–¥–∞:**
   - –£–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É –æ–ø–ª–∞—Ç—ã
   - –£–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤
   - –í—ã–±–∏—Ä–∞–µ—Ç –≤–∞–ª—é—Ç—É
3. **–ü–æ–ª—É—á–µ–Ω–∏–µ —á–µ–∫–∞** —Å 6-–∑–Ω–∞—á–Ω—ã–º –∫–æ–¥–æ–º
4. **–ü–µ—á–∞—Ç—å —á–µ–∫–∞** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

### **–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:**
1. **–ü–æ–ª—É—á–∞–µ—Ç —á–µ–∫** —Å OTP –∫–æ–¥–æ–º
2. **–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
3. **–í–≤–æ–¥–∏—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥**
4. **AR —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è** –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**
1. **Django** ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç OTP ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
2. **Django** ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å Firebase
3. **Unity** ‚Üí –≤–≤–æ–¥–∏—Ç –∫–æ–¥ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Django API
4. **Django** ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ Firebase ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
5. **Unity** ‚Üí –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç AR —Ñ—É–Ω–∫—Ü–∏–∏

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Unity

### **–®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ OTPManager –≤ —Å—Ü–µ–Ω—É**
```csharp
// –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç–æ–π GameObject
GameObject otpManager = new GameObject("OTPManager");
otpManager.AddComponent<OTPManager>();
```

### **–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ UI —ç–ª–µ–º–µ–Ω—Ç—ã**
```csharp
// –í Inspector –Ω–∞–∑–Ω–∞—á—å—Ç–µ:
otpInputPanel - –ø–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ OTP
otpInputField - –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ 6 —Ü–∏—Ñ—Ä
activateButton - –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
statusText - —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
closeButton - –∫–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
```

### **–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API URL**
```csharp
// –í Inspector –∏–∑–º–µ–Ω–∏—Ç–µ:
otpApiUrl = "http://your-domain.com/otp/api/verify/"
```

### **–®–∞–≥ 4: –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è**
```csharp
void Start()
{
    OTPManager.Instance.OnOTPActivated += OnOTPActivated;
    OTPManager.Instance.OnOTPError += OnOTPError;
}

void OnOTPActivated(float amount, int quantity, string currency)
{
    Debug.Log($"OTP –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: {amount} {currency} –Ω–∞ {quantity} —á–µ–∫–æ–≤");
    // –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ AR —Ñ—É–Ω–∫—Ü–∏–∏
    ActivateARFunctions(quantity);
}

void OnOTPError(string error)
{
    Debug.LogError($"OTP –æ—à–∏–±–∫–∞: {error}");
}
```

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### **–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å OTP:**
```csharp
OTPManager.Instance.ShowOTPPanel();
```

### **–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å OTP:**
```csharp
OTPManager.Instance.HideOTPPanel();
```

### **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
```csharp
if (OTPManager.Instance.IsOTPActive())
{
    Debug.Log("OTP –∫–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω");
}
```

### **–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–¥:**
```csharp
string code = OTPManager.Instance.GetCurrentOTPCode();
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ARPaymentController

### **–î–æ–±–∞–≤—å—Ç–µ –≤ ARPaymentController:**
```csharp
[Header("OTP Integration")]
[SerializeField] private UnityEngine.UI.Button otpButton;

void Start()
{
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    if (otpButton != null)
    {
        otpButton.onClick.AddListener(ShowOTPPanel);
    }
    
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ OTP —Å–æ–±—ã—Ç–∏—è
    if (OTPManager.Instance != null)
    {
        OTPManager.Instance.OnOTPActivated += OnOTPActivated;
    }
}

void ShowOTPPanel()
{
    if (OTPManager.Instance != null)
    {
        OTPManager.Instance.ShowOTPPanel();
    }
}

void OnOTPActivated(float amount, int quantity, string currency)
{
    Debug.Log($"OTP –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: {amount} {currency} –Ω–∞ {quantity} —á–µ–∫–æ–≤");
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ AR —Ñ—É–Ω–∫—Ü–∏–∏
    ActivateARFunctions(quantity);
    
    // –û–±–Ω–æ–≤–∏—Ç–µ UI
    UpdateSubscriptionDisplay(amount, quantity, currency);
}
```

## üì± UI –ü—Ä–∏–º–µ—Ä

### **–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–Ω–µ–ª—å OTP:**
```
Canvas
‚îî‚îÄ‚îÄ OTP Panel (Image)
    ‚îú‚îÄ‚îÄ Title Text: "–í–≤–µ–¥–∏—Ç–µ OTP –∫–æ–¥"
    ‚îú‚îÄ‚îÄ Input Field (6 —Å–∏–º–≤–æ–ª–æ–≤, —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
    ‚îú‚îÄ‚îÄ Activate Button (–∞–∫—Ç–∏–≤–Ω–∞ –ø—Ä–∏ 6 —Ü–∏—Ñ—Ä–∞—Ö)
    ‚îú‚îÄ‚îÄ Status Text (—Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏)
    ‚îî‚îÄ‚îÄ Close Button (–∑–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å)
```

### **–°—Ç–∏–ª–∏–∑–∞—Ü–∏—è:**
- **–¶–≤–µ—Ç–∞:** Primary –¥–ª—è –∫–Ω–æ–ø–æ–∫, Success –¥–ª—è —É—Å–ø–µ—Ö–∞, Danger –¥–ª—è –æ—à–∏–±–æ–∫
- **–†–∞–∑–º–µ—Ä—ã:** –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **–ê–Ω–∏–º–∞—Ü–∏–∏:** –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:**
- ‚úÖ –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã (0-9)
- ‚úÖ –†–æ–≤–Ω–æ 6 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π device_id

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Firebase
- ‚úÖ –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ò—Å—Ç–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **1. –°–æ–∑–¥–∞–π—Ç–µ OTP –∫–æ–¥ –≤ Django:**
```
http://localhost:8000/otp/
‚Üí –°–æ–∑–¥–∞—Ç—å OTP –∫–æ–¥
‚Üí –°—É–º–º–∞: 5000, –ß–µ–∫–æ–≤: 3
‚Üí –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥: 123456
```

### **2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ Unity:**
```
‚Üí –ü–æ–∫–∞–∂–∏—Ç–µ OTP –ø–∞–Ω–µ–ª—å
‚Üí –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥: 123456
‚Üí –ù–∞–∂–º–∏—Ç–µ "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"
‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
```

### **3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Firebase:**
```
‚Üí –û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console
‚Üí Database ‚Üí activation_codes
‚Üí –ù–∞–π–¥–∏—Ç–µ –≤–∞—à –∫–æ–¥
‚Üí –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "used"
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### **–û—à–∏–±–∫–∞ "ModuleNotFoundError: Newtonsoft.Json"**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Newtonsoft.Json –¥–ª—è Unity
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Unity's built-in JsonUtility
```

### **–û—à–∏–±–∫–∞ "Connection refused"**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ Django —Å–µ—Ä–≤–µ—Ä
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ otpApiUrl
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å
```

### **OTP –∫–æ–¥ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Firebase —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫–∞—Å—Å–∏—Ä–∞
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### **–ú–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è OTP:**
```python
# –í Django shell
from otp_manager.models import OTPCode
from django.contrib.auth.models import User

cashier = User.objects.get(username='cashier1')
for i in range(10):
    OTPCode.objects.create(
        code=f"{i:06d}",
        amount=1000,
        quantity=1,
        created_by=cashier
    )
```

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ OTP:**
```python
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–¥–æ–≤
active_count = OTPCode.objects.filter(status='active').count()

# –û–±—â–∞—è —Å—É–º–º–∞ –ø–æ OTP
total_amount = OTPCode.objects.filter(status='used').aggregate(
    total=Sum('amount')
)['total']
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ OTP –∞–∫—Ç–∏–≤–∞—Ü–∏–∏** –∫–æ—Ç–æ—Ä–∞—è:

- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π** Freedom Pay
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Firebase** –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ò–º–µ–µ—Ç —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –∫–∞—Å—Å–∏—Ä–æ–≤
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞ –∏ –Ω–∞–¥–µ–∂–Ω–∞** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è** –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ**
